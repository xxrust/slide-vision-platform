<Window x:Class="WpfApp2.UI.RealTimeDataExportConfigWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="实时数据导出配置"
        Width="1200"
        Height="720"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Orientation="Vertical">
            <TextBlock Text="实时数据导出配置（仅影响实时CSV）"
                       FontSize="16"
                       FontWeight="Bold"
                       Margin="0,0,0,8"/>

            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="输出方式："
                           VerticalAlignment="Center"
                           Margin="0,0,10,0"/>
                <RadioButton x:Name="DefaultModeRadio"
                             Content="默认方式输出"
                             VerticalAlignment="Center"
                             Margin="0,0,12,0"
                             Checked="DefaultModeRadio_Checked"/>
                <RadioButton x:Name="CustomModeRadio"
                             Content="按自定义模板输出"
                             VerticalAlignment="Center"
                             Margin="0,0,12,0"
                             Checked="CustomModeRadio_Checked"/>
                <TextBlock Text="（切换后对新生成文件生效）"
                           VerticalAlignment="Center"
                           Foreground="Gray"/>
            </StackPanel>

            <WrapPanel>
                <TextBlock Text="当前模板："
                           VerticalAlignment="Center"
                           Margin="0,0,10,0"/>
                <ComboBox x:Name="TemplateComboBox"
                          Width="220"
                          DisplayMemberPath="Name"
                          SelectionChanged="TemplateComboBox_SelectionChanged"
                          Margin="0,0,10,0"/>
                <Button Content="新建"
                        Width="70"
                        Margin="0,0,6,0"
                        Click="NewTemplateButton_Click"/>
                <Button Content="复制"
                        Width="70"
                        Margin="0,0,6,0"
                        Click="CopyTemplateButton_Click"/>
                <Button Content="重命名"
                        Width="70"
                        Margin="0,0,6,0"
                        Click="RenameTemplateButton_Click"/>
                <Button Content="删除"
                        Width="70"
                        Margin="0,0,18,0"
                        Click="DeleteTemplateButton_Click"/>
                <Button Content="按默认策略生成"
                        Width="120"
                        Margin="0,0,6,0"
                        Click="GenerateDefaultTemplateButton_Click"/>
                <Button Content="刷新项目"
                        Width="90"
                        Margin="0,0,6,0"
                        Click="RefreshItemsButton_Click"/>
            </WrapPanel>
        </StackPanel>

        <Grid Grid.Row="1" Margin="0,10,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <GroupBox Grid.Column="0" Header="可选检测项目（来自主界面表格）" Margin="0,0,6,0">
                <DataGrid x:Name="AvailableItemsDataGrid"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          IsReadOnly="True"
                          HeadersVisibility="Column"
                          ItemsSource="{Binding AvailableItems}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="项目名" Binding="{Binding Name}" Width="2*"/>
                        <DataGridTextColumn Header="上限" Binding="{Binding UpperLimit}" Width="*"/>
                        <DataGridTextColumn Header="下限" Binding="{Binding LowerLimit}" Width="*"/>
                        <DataGridTemplateColumn Header="添加到模板" Width="260">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Button Content="值" Width="45" Margin="0,0,6,0" Click="AddValueButton_Click" Tag="{Binding}"/>
                                        <Button Content="上限" Width="55" Margin="0,0,6,0" Click="AddUpperLimitButton_Click" Tag="{Binding}"/>
                                        <Button Content="下限" Width="55" Margin="0,0,6,0" Click="AddLowerLimitButton_Click" Tag="{Binding}"/>
                                        <Button Content="超限" Width="55" Click="AddOutOfRangeButton_Click" Tag="{Binding}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </GroupBox>

            <GroupBox Grid.Column="1" Header="导出模板列（从上到下=从左到右）" Margin="6,0,0,0">
                <DockPanel>
                    <WrapPanel DockPanel.Dock="Top" Margin="0,0,0,8">
                        <TextBlock Text="基础字段："
                                   VerticalAlignment="Center"
                                   Margin="0,0,10,0"/>
                        <Button Content="序号" Width="60" Margin="0,0,6,0" Click="AddMetaImageNumberButton_Click"/>
                        <Button Content="时间戳" Width="70" Margin="0,0,6,0" Click="AddMetaTimestampButton_Click"/>
                        <Button Content="LOT号" Width="60" Margin="0,0,6,0" Click="AddMetaLotNumberButton_Click"/>
                        <Button Content="缺陷类型" Width="80" Margin="0,0,6,0" Click="AddMetaDefectTypeButton_Click"/>
                        <Button Content="结果" Width="60" Margin="0,0,16,0" Click="AddMetaResultButton_Click"/>
                    </WrapPanel>

                    <WrapPanel DockPanel.Dock="Bottom" Margin="0,8,0,0" HorizontalAlignment="Right">
                        <Button Content="上移" Width="70" Margin="0,0,6,0" Click="MoveUpButton_Click"/>
                        <Button Content="下移" Width="70" Margin="0,0,6,0" Click="MoveDownButton_Click"/>
                        <Button Content="移除" Width="70" Margin="0,0,6,0" Click="RemoveButton_Click"/>
                        <Button Content="清空" Width="70" Click="ClearButton_Click"/>
                    </WrapPanel>

                    <DataGrid x:Name="TemplateColumnsDataGrid"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              ItemsSource="{Binding TemplateColumns}"
                              SelectionMode="Single"
                              LoadingRow="TemplateColumnsDataGrid_LoadingRow">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="#" Binding="{Binding Order}" Width="50"/>
                            <DataGridTextColumn Header="列内容" Binding="{Binding DisplayText}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </GroupBox>
        </Grid>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
            <Button Content="保存" Width="90" Margin="0,0,8,0" Click="SaveButton_Click"/>
            <Button Content="关闭" Width="90" Click="CloseButton_Click"/>
        </StackPanel>
    </Grid>
</Window>

