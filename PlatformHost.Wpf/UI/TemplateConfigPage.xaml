<Page x:Class="WpfApp2.UI.TemplateConfigPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:WpfApp2.UI"
      xmlns:controls="clr-namespace:WpfApp2.UI.Controls"
      mc:Ignorable="d" 
      d:DesignHeight="1024" d:DesignWidth="1920"
      Title="模板配置">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 顶部标题栏 -->
        <Grid Grid.Row="0" Background="#FF020223" Height="50">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="380"/>
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Grid.Column="0">
                <TextBlock Text="模板配置" FontSize="24" Foreground="White" Margin="20,0,10,0"/>
                <TextBlock Text="·" FontSize="24" Foreground="LightGray" Margin="0,0,10,0"/>
                <TextBlock x:Name="CurrentTemplateNameDisplay" Text="" FontSize="20" Foreground="#FFA569BD" FontWeight="Bold" Margin="0,0,0,0"/>
            </StackPanel>

            <!-- 右侧按钮组 -->
            <StackPanel Orientation="Horizontal" Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center">
                <!-- 显示log按钮 - 使用灰色主题，日志图标 -->
                <Border Background="#FF95A5A6" BorderThickness="1" BorderBrush="#FF7F8C8D" 
                        Width="110" Height="40" Margin="8,0" CornerRadius="6">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" Direction="315" ShadowDepth="2" Opacity="0.3"/>
                    </Border.Effect>
                    <Button x:Name="ShowLogButton" Click="ShowLogButton_Click" Padding="8" Background="Transparent" 
                            BorderThickness="0" Cursor="Hand">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#FFBDC3C7"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="📄" FontSize="14" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Text="显示log" VerticalAlignment="Center" FontSize="14" FontWeight="Medium" Foreground="White"/>
                        </StackPanel>
                    </Button>
                </Border>

                <!-- 数据分析按钮 - 使用深紫色主题，图表图标 -->
                <Border Background="#FF8E44AD" BorderThickness="1" BorderBrush="#FF7D3C98" 
                        Width="110" Height="40" Margin="8,0" CornerRadius="6">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" Direction="315" ShadowDepth="2" Opacity="0.3"/>
                    </Border.Effect>
                    <Button x:Name="ConfigDataAnalysisButton" Click="ConfigDataAnalysisButton_Click" Padding="8" 
                            Background="Transparent" BorderThickness="0" Cursor="Hand">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#FFA569BD"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="📊" FontSize="14" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Text="数据分析" VerticalAlignment="Center" FontSize="14" FontWeight="Medium" Foreground="White"/>
                        </StackPanel>
                    </Button>
                </Border>

                <Button x:Name="BackButton" Content="← 返回" 
                        Click="BackButton_Click" 
                        Background="Transparent" 
                        Foreground="White" 
                        BorderThickness="1" 
                        BorderBrush="White"
                        Padding="10,5" 
                        Margin="15,0,0,0"
                        FontSize="16"/>
            </StackPanel>
        </Grid>

        <!-- 配置项目流程区域 -->
        <Grid Grid.Row="1" Height="90" x:Name="Grid1">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#E8F4FD" Offset="0"/>
                    <GradientStop Color="#D0E8F2" Offset="1"/>
                </LinearGradientBrush>
            </Grid.Background>
            <!-- 添加一个微妙的边框 -->
            <Border BorderBrush="#B0C4DE" BorderThickness="0,1,0,1"/>
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                <StackPanel x:Name="StepButtonsPanel" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <!-- 步骤按钮将通过代码动态生成 -->
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- 主内容区域 -->
        <Grid Grid.Row="2" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧预览区域 -->
            <Border Grid.Column="0" BorderBrush="Gray" BorderThickness="1" Margin="5">
                <Grid x:Name="ImagePreviewContainer">
                    <!-- 单一预览区域（第一步以外的步骤显示） -->
                    <Grid x:Name="SingleImageContainer" Visibility="Visible">
                        <Grid>
                            <controls:ImageInspectionViewer x:Name="StepPreviewViewer"/>
                        </Grid>
                    </Grid>

                    <!-- 3个图像源显示区域（第一步图片选择时显示，2x2布局） -->
                    <Grid x:Name="MultiImageContainer" Visibility="Collapsed">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <GroupBox x:Name="Source1Group" Grid.Row="0" Grid.Column="0" Header="图像1" FontSize="14" Foreground="Green" Margin="2">
                            <Grid>
                                <controls:ImageInspectionViewer x:Name="PreviewViewer1"/>
                            </Grid>
                        </GroupBox>
                        
                        <GroupBox x:Name="Source2Group" Grid.Row="0" Grid.Column="1" Header="图像2" FontSize="14" Foreground="Green" Margin="2">
                            <Grid>
                                <controls:ImageInspectionViewer x:Name="PreviewViewer2"/>
                            </Grid>
                        </GroupBox>
                        
                        <GroupBox x:Name="Source3Group" Grid.Row="1" Grid.Column="0" Header="图像3" FontSize="14" Foreground="Green" Margin="2">
                            <Grid>
                                <controls:ImageInspectionViewer x:Name="PreviewViewer3"/>
                            </Grid>
                        </GroupBox>

                        <GroupBox x:Name="Source4Group" Grid.Row="1" Grid.Column="1" Header="图像4" FontSize="14" Foreground="Green" Margin="2">
                            <Grid>
                                <controls:ImageInspectionViewer x:Name="PreviewViewer4"/>
                            </Grid>
                        </GroupBox>

                        <GroupBox x:Name="Source5Group" Grid.Row="2" Grid.Column="0" Header="图像5" FontSize="14" Foreground="Green" Margin="2">
                            <Grid>
                                <controls:ImageInspectionViewer x:Name="PreviewViewer5"/>
                            </Grid>
                        </GroupBox>

                        <GroupBox x:Name="Source6Group" Grid.Row="2" Grid.Column="1" Header="图像6" FontSize="14" Foreground="Green" Margin="2">
                            <Grid>
                                <controls:ImageInspectionViewer x:Name="PreviewViewer6"/>
                            </Grid>
                        </GroupBox>

                        <GroupBox x:Name="Source7Group" Grid.Row="3" Grid.Column="0" Header="图像7" FontSize="14" Foreground="Green" Margin="2">
                            <Grid>
                                <controls:ImageInspectionViewer x:Name="PreviewViewer7"/>
                            </Grid>
                        </GroupBox>

                        <GroupBox x:Name="Source8Group" Grid.Row="3" Grid.Column="1" Header="图像8" FontSize="14" Foreground="Green" Margin="2">
                            <Grid>
                                <controls:ImageInspectionViewer x:Name="PreviewViewer8"/>
                            </Grid>
                        </GroupBox>

                        <GroupBox x:Name="Source9Group" Grid.Row="4" Grid.Column="0" Header="图像9" FontSize="14" Foreground="Green" Margin="2">
                            <Grid>
                                <controls:ImageInspectionViewer x:Name="PreviewViewer9"/>
                            </Grid>
                        </GroupBox>

                        <GroupBox x:Name="Source10Group" Grid.Row="4" Grid.Column="1" Header="图像10" FontSize="14" Foreground="Green" Margin="2">
                            <Grid>
                                <controls:ImageInspectionViewer x:Name="PreviewViewer10"/>
                            </Grid>
                        </GroupBox>
                    </Grid>

                    <!-- 3D视图显示区域（3D配置步骤时显示） -->
                    <Grid x:Name="ThreeDContainer" Visibility="Collapsed">
                        <GroupBox Header="3D检测视图" FontSize="16" Foreground="Purple" Margin="5">
                            <WindowsFormsHost x:Name="_3DViewHost_Template"/>
                        </GroupBox>
                    </Grid>
                </Grid>
            </Border>

            <!-- 右侧参数区域 -->
            <Grid Grid.Column="1" Margin="5">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 参数输入区域 -->
                <GroupBox Grid.Row="0" Header="参数输入" FontSize="16" Foreground ="white">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="InputParametersPanel">
                            <!-- 参数输入控件将根据当前配置步骤动态添加 -->
                        </StackPanel>
                    </ScrollViewer>
                </GroupBox>

                <!-- 参数输出区域 -->
                <GroupBox Grid.Row="1" Header="检测结果" FontSize="16" Foreground ="white">
                    <Grid>
                        <DataGrid x:Name="ConfigDataGrid" AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False" CanUserReorderColumns="False" CanUserResizeColumns="False" CanUserResizeRows="False" CanUserSortColumns="False" IsReadOnly="True" SelectionMode="Single" SelectionUnit="Cell" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="NO." Binding="{Binding RowNumber}" Width="40"/>
                                <DataGridTextColumn Header="项目" Binding="{Binding Name}" Width="*" />
                                <DataGridTextColumn Header="数值" Binding="{Binding Value}" Width="80"/>
                                <DataGridTextColumn Header="Min" Binding="{Binding LowerLimit}" Width="60"/>
                                <DataGridTextColumn Header="Max" Binding="{Binding UpperLimit}" Width="60"/>
                            </DataGrid.Columns>
                            <DataGrid.Resources>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="FontSize" Value="12"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                </Style>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="FontSize" Value="11"/>
                                </Style>
                            </DataGrid.Resources>
                        </DataGrid>
                    </Grid>
                </GroupBox>
                <!-- 参数输出控件将根据当前配置步骤动态添加 -->

                <!-- 导航按钮区域 -->
                <Grid Grid.Row="2" Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0" Content="上一项" FontSize="18" Height="50" Margin="5" Click="PreviousStep_Click"/>
                    <Button Grid.Column="1" Content="执行" FontSize="18" Height="50" Margin="5" Background="Green" Foreground="White" Click="Execute_Click"/>
                    <Button Grid.Column="2" Content="下一项" FontSize="18" Height="50" Margin="5" Click="NextStep_Click"/>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</Page>
