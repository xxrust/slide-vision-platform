<Page x:Class="WpfApp2.UI.PLCSerialConfigPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:WpfApp2.UI"
      mc:Ignorable="d" 
      d:DesignHeight="800" d:DesignWidth="1200"
      Title="PLC串口配置"
      Loaded="PLCSerialConfigPage_Loaded"
      Unloaded="Page_Unloaded">

    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Page.Resources>

        <Grid Background="#FFF5F5F5" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="ConfigColumn" Width="400"/>
                <ColumnDefinition x:Name="TestColumn" Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧面板 -->
            <Grid x:Name="ConfigPanel" Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- 串口配置面板 -->
                <GroupBox Grid.Row="0" Header="串口配置" FontSize="14" FontWeight="Bold" Margin="0,0,10,10">
                    <StackPanel Margin="15">
                        <!-- 串口选择 -->
                        <Label Content="串口号:" FontWeight="Bold"/>
                        <ComboBox x:Name="PortComboBox" Height="30" Margin="0,0,0,15"
                                  SelectionChanged="PortComboBox_SelectionChanged"/>
                        
                        <!-- 波特率设置 -->
                        <Label Content="波特率:" FontWeight="Bold"/>
                        <ComboBox x:Name="BaudRateComboBox" Height="30" Margin="0,0,0,15"
                                  SelectedValue="9600" SelectionChanged="BaudRateComboBox_SelectionChanged">
                            <ComboBoxItem Content="9600" IsSelected="True"/>
                            <ComboBoxItem Content="19200"/>
                            <ComboBoxItem Content="38400"/>
                            <ComboBoxItem Content="57600"/>
                            <ComboBoxItem Content="115200"/>
                        </ComboBox>
                        
                        <!-- 超时设置 -->
                        <Label Content="超时时间(毫秒):" FontWeight="Bold"/>
                        <TextBox x:Name="TimeoutTextBox" Height="30" Text="5000" Margin="0,0,0,15"
                                 TextChanged="TimeoutTextBox_TextChanged"/>
                        
                        <!-- 连接状态 -->
                        <Label Content="连接状态:" FontWeight="Bold"/>
                        <Border x:Name="StatusBorder" Height="30" Margin="0,0,0,15" 
                                Background="#FFFF6B6B" CornerRadius="5">
                            <TextBlock x:Name="StatusText" Text="未连接" 
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Foreground="White" FontWeight="Bold"/>
                        </Border>
                        
                        <!-- 控制按钮 -->
                        <Grid Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <Button Grid.Column="0" x:Name="ConnectButton" Content="连接" Height="35"
                                    Background="#FF27AE60" Foreground="White" FontWeight="Bold"
                                    Click="ConnectButton_Click">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="5" BorderThickness="0">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            
                            <Button Grid.Column="2" x:Name="DisconnectButton" Content="断开" Height="35"
                                    Background="#FFFF6B6B" Foreground="White" FontWeight="Bold"
                                    Click="DisconnectButton_Click">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="5" BorderThickness="0">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>
                        
                        <!-- 刷新串口按钮 -->
                        <Button x:Name="RefreshPortsButton" Content="刷新串口列表" Height="35" Margin="0,10,0,0"
                                Background="#FF3498DB" Foreground="White" FontWeight="Bold"
                                Click="RefreshPortsButton_Click">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" CornerRadius="5" BorderThickness="0">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                    </StackPanel>
                </GroupBox>
                
                <!-- 通信日志面板 -->
                <GroupBox Grid.Row="1" Header="通信日志" FontSize="14" FontWeight="Bold" Margin="0,0,10,0">
                    <Grid Margin="15">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <TextBox Grid.Row="0" x:Name="LogTextBox" 
                                 IsReadOnly="True" VerticalScrollBarVisibility="Auto"
                                 FontFamily="Consolas" FontSize="12"
                                 Background="#FFF8F8F8" BorderBrush="#FFCCCCCC"/>
                        
                        <Button Grid.Row="1" x:Name="ClearLogButton" Content="清空日志" 
                                Height="30" Width="100" Margin="0,10,0,0"
                                HorizontalAlignment="Right"
                                Background="#FF95A5A6" Foreground="White" FontWeight="Bold"
                                Click="ClearLogButton_Click">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}" CornerRadius="3" BorderThickness="0">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Grid>
                </GroupBox>
            </Grid>

                            <!-- 右侧测试面板 -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 测试控制面板 -->
                <GroupBox Grid.Row="0" Header="PLC测试" FontSize="14" FontWeight="Bold" Margin="0,0,0,10">
                    <Grid Margin="15">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- 第一行：读取测试 -->
                        <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,10,10">
                            <Label Content="读取寄存器:" FontWeight="Bold"/>
                            <TextBox x:Name="ReadAddressTextBox" Height="30" Text="R1" Margin="0,0,0,5"/>
                            <Button x:Name="ReadButton" Content="读取" Height="30"
                                    Background="#FF9B59B6" Foreground="White" FontWeight="Bold"
                                    Click="ReadButton_Click">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="3" BorderThickness="0">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </StackPanel>

                        <!-- 第二行：写入测试 -->
                        <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,10,10">
                            <Label Content="写入寄存器:" FontWeight="Bold"/>
                            <TextBox x:Name="WriteAddressTextBox" Height="30" Text="MR2000" Margin="0,0,0,5"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="5"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" x:Name="WriteValueTextBox" Height="30" Text="1"/>
                                <Button Grid.Column="2" x:Name="WriteButton" Content="写入" Height="30"
                                        Background="#FFF39C12" Foreground="White" FontWeight="Bold"
                                        Click="WriteButton_Click">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="3" BorderThickness="0">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </Grid>
                        </StackPanel>

                        <!-- 第三行：继电器控制 -->
                        <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,0,10">
                            <Label Content="继电器控制:" FontWeight="Bold"/>
                            <TextBox x:Name="RelayAddressTextBox" Height="30" Text="MR1915" Margin="0,0,0,5"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="5"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Button Grid.Column="0" x:Name="SetRelayButton" Content="置位" Height="30"
                                        Background="#FF27AE60" Foreground="White" FontWeight="Bold"
                                        Click="SetRelayButton_Click">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="3" BorderThickness="0">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                                <Button Grid.Column="2" x:Name="ResetRelayButton" Content="复位" Height="30"
                                        Background="#FFFF6B6B" Foreground="White" FontWeight="Bold"
                                        Click="ResetRelayButton_Click">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="3" BorderThickness="0">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </Grid>
                        </StackPanel>
                    </Grid>
                </GroupBox>

                <!-- 组件调试面板 -->
                <GroupBox Grid.Row="1" Header="组件调试" FontSize="14" FontWeight="Bold" Margin="0,0,0,10">
                    <Grid Margin="15">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- 添加卡片按钮 -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                            <Button x:Name="AddRelayCardButton" Content="添加继电器卡片" Height="30" Width="120" Margin="0,0,10,0"
                                    Background="#FF27AE60" Foreground="White" FontWeight="Bold" FontSize="12"
                                    Click="AddRelayCardButton_Click">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="3" BorderThickness="0">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            
                            <Button x:Name="AddSensorCardButton" Content="添加传感器卡片" Height="30" Width="120" Margin="0,0,10,0"
                                    Background="#FF3498DB" Foreground="White" FontWeight="Bold" FontSize="12"
                                    Click="AddSensorCardButton_Click">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="3" BorderThickness="0">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            
                            <Button x:Name="AddDataCardButton" Content="添加数据卡片" Height="30" Width="100" Margin="0,0,10,0"
                                    Background="#FFF39C12" Foreground="White" FontWeight="Bold" FontSize="12"
                                    Click="AddDataCardButton_Click">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="3" BorderThickness="0">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            
                            <Button x:Name="RemoveCardButton" Content="删除选中卡片" Height="30" Width="100"
                                    Background="#FFFF6B6B" Foreground="White" FontWeight="Bold" FontSize="12"
                                    Click="RemoveCardButton_Click">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="3" BorderThickness="0">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </StackPanel>
                        
                        <!-- 卡片列表 -->
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <ItemsControl x:Name="ComponentItemsControl">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Columns="5" Margin="0,0,0,10"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="White" BorderBrush="#FFDDDDDD" BorderThickness="1" 
                                            CornerRadius="6" Margin="3" Padding="10">
                                        <Border.Effect>
                                            <DropShadowEffect Color="#FFD0D0D0" BlurRadius="3" ShadowDepth="1" Opacity="0.3"/>
                                        </Border.Effect>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <!-- 项目名称 -->
                                            <TextBlock Grid.Row="0" Text="{Binding Name}" FontSize="14" FontWeight="Bold" 
                                                       Foreground="#FF2C3E50" HorizontalAlignment="Center" Margin="0,0,0,6"
                                                       MouseLeftButtonDown="ComponentName_MouseLeftButtonDown" Cursor="Hand"/>
                                            
                                            <!-- 寄存器地址 -->
                                            <TextBlock Grid.Row="1" HorizontalAlignment="Center" Margin="0,0,0,6" FontSize="12">
                                                <TextBlock.Inlines>
                                                    <Run Text="寄存器: " FontWeight="Bold" Foreground="#FF7F8C8D"/>
                                                    <Run Text="{Binding Register}" FontWeight="Bold" Foreground="#FF34495E"/>
                                                </TextBlock.Inlines>
                                            </TextBlock>
                                            
                                            <!-- 继电器控制卡片 - 状态显示和控制按钮 -->
                                            <StackPanel Grid.Row="2" Visibility="{Binding IsRelayControl, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                <!-- 当前状态 -->
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,6">
                                                    <Ellipse Width="16" Height="16" Margin="0,0,5,0">
                                                        <Ellipse.Style>
                                                            <Style TargetType="Ellipse">
                                                                <Setter Property="Fill" Value="#FFFF6B6B"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding CurrentStatus}" Value="True">
                                                                        <Setter Property="Fill" Value="#FF27AE60"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Ellipse.Style>
                                                    </Ellipse>
                                                    <TextBlock VerticalAlignment="Center" FontWeight="Bold" FontSize="12">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Text" Value="关闭"/>
                                                                <Setter Property="Foreground" Value="#FFFF6B6B"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding CurrentStatus}" Value="True">
                                                                        <Setter Property="Text" Value="开启"/>
                                                                        <Setter Property="Foreground" Value="#FF27AE60"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </StackPanel>
                                            </StackPanel>
                                            
                                            <!-- 传感器读取卡片 - 只显示状态 -->
                                            <StackPanel Grid.Row="2" Visibility="{Binding IsSensorRead, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                <!-- 传感器状态 -->
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,6">
                                                    <Ellipse Width="16" Height="16" Margin="0,0,5,0">
                                                        <Ellipse.Style>
                                                            <Style TargetType="Ellipse">
                                                                <Setter Property="Fill" Value="#FF95A5A6"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding CurrentStatus}" Value="True">
                                                                        <Setter Property="Fill" Value="#FF3498DB"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Ellipse.Style>
                                                    </Ellipse>
                                                    <TextBlock VerticalAlignment="Center" FontWeight="Bold" FontSize="12">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Text" Value="无信号"/>
                                                                <Setter Property="Foreground" Value="#FF95A5A6"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding CurrentStatus}" Value="True">
                                                                        <Setter Property="Text" Value="有信号"/>
                                                                        <Setter Property="Foreground" Value="#FF3498DB"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </StackPanel>
                                            </StackPanel>
                                            
                                            <!-- 数据写入卡片 - 数值显示和输入 -->
                                            <StackPanel Grid.Row="2" Visibility="{Binding IsDataWrite, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                <!-- 当前值显示 -->
                                                <TextBlock HorizontalAlignment="Center" Margin="0,0,0,4" FontSize="12">
                                                    <TextBlock.Inlines>
                                                        <Run Text="当前值: " Foreground="#FF7F8C8D"/>
                                                        <Run Text="{Binding CurrentValue}" FontWeight="Bold" Foreground="#FF2980B9"/>
                                                    </TextBlock.Inlines>
                                                </TextBlock>
                                                <!-- 写入值输入 -->
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,6">
                                                    <TextBox Width="60" Height="24" Text="{Binding WriteValue, UpdateSourceTrigger=PropertyChanged}" 
                                                             FontSize="12" TextAlignment="Center" VerticalContentAlignment="Center"/>
                                                    <Button Content="写入" Width="40" Height="24" Margin="3,0,0,0" FontSize="10"
                                                            Background="#FFF39C12" Foreground="White" FontWeight="Bold"
                                                            Click="ComponentWriteButton_Click" Tag="{Binding}">
                                                        <Button.Template>
                                                            <ControlTemplate TargetType="Button">
                                                                <Border Background="{TemplateBinding Background}" CornerRadius="2" BorderThickness="0">
                                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                </Border>
                                                            </ControlTemplate>
                                                        </Button.Template>
                                                    </Button>
                                                </StackPanel>
                                            </StackPanel>
                                            
                                            <!-- 继电器控制按钮 -->
                                            <Grid Grid.Row="3" Visibility="{Binding IsRelayControl, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="5"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <Button Grid.Column="0" Content="置位" Height="28" FontWeight="Bold" FontSize="12"
                                                        Background="#FF27AE60" Foreground="White"
                                                        Click="ComponentSetButton_Click" Tag="{Binding}">
                                                    <Button.Template>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}" CornerRadius="3" BorderThickness="0">
                                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Button.Template>
                                                </Button>
                                                
                                                <Button Grid.Column="2" Content="复位" Height="28" FontWeight="Bold" FontSize="12"
                                                        Background="#FFFF6B6B" Foreground="White"
                                                        Click="ComponentResetButton_Click" Tag="{Binding}">
                                                    <Button.Template>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}" CornerRadius="3" BorderThickness="0">
                                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Button.Template>
                                                </Button>
                                            </Grid>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </GroupBox>
        </Grid>
    </Grid>
</Page> 
