# WpfApp2 SMTGPIO IO板集成说明

## 概述
本文档说明如何在WpfApp2点胶检测项目中使用SMTGPIO IO板控制功能。

## 集成内容

### 1. 文件结构
```
WpfApp2/
├── SMTGPIO/
│   ├── SMTGPIOController.cs   # IO板控制器类
│   ├── IOManager.cs           # IO管理器（静态类）
│   └── README.md             # 本说明文档
├── App.xaml.cs               # 应用启动时初始化IO
├── UI/
│   ├── Page1.xaml           # 添加了IO复位按钮
│   ├── Page1.xaml.cs        # 添加了IO复位事件处理
│   └── TemplateConfigPage.xaml.cs  # 检测完成时控制IO输出
└── SMTGPIO.dll              # IO板驱动DLL（需要放置在输出目录）
```

## 功能说明

### 1. 自动初始化
- **时机**: 软件启动时自动初始化IO板
- **位置**: `App.xaml.cs`的`OnStartup`方法中
- **行为**: 
  - 尝试初始化SMTGPIO设备
  - 初始化成功后复位所有IO输出
  - 初始化失败时显示错误提示但不影响软件正常运行

### 2. 检测结果输出
- **时机**: VM检测完成后自动设置IO输出
- **位置**: `TemplateConfigPage.xaml.cs`的`UpdateDefectStatisticsUI`方法中
- **输出规则**:
  - **检测OK**: IO1=1, IO2=1
  - **检测NG**: IO1=1, IO2=0

### 3. 手动复位功能
- **位置**: Page1主界面右上角的"IO复位"按钮
- **功能**: 手动将所有IO输出设置为低电平（IO1=0, IO2=0）
- **用途**: 方便用户在需要时手动复位IO状态

### 4. 自动资源释放
- **时机**: 软件退出时自动释放IO资源
- **位置**: `App.xaml.cs`的`OnExit`方法中
- **行为**: 复位所有IO输出并释放硬件资源

## 日志记录

### 日志输出位置
1. **Page1界面日志**: 显示在主界面的日志列表中，前缀为"[IO]"
2. **控制台输出**: 用于调试，包含详细的错误信息
3. **本地日志文件**: 按日期保存在Log文件夹中

### 日志级别
- **Info**: 一般信息（如初始化成功、IO状态变更）
- **Warning**: 警告信息（如IO未初始化的操作尝试）
- **Error**: 错误信息（会自动弹窗提示用户）

## 错误处理

### 常见错误及解决方案

#### 1. 初始化失败
**错误现象**: 软件启动时显示"IO板初始化失败"
**可能原因**:
- SMTGPIO.dll文件不存在或版本不匹配
- IO板硬件未连接或连接异常
- 应用程序权限不足
- 设备驱动未正确安装

**解决方案**:
1. 确认SMTGPIO.dll文件存在于应用程序根目录或系统PATH中
2. 检查IO板硬件连接
3. 以管理员权限运行应用程序
4. 重新安装IO板驱动程序

#### 2. 操作失败
**错误现象**: 设置IO输出时显示操作失败
**可能原因**:
- IO板连接中断
- 硬件故障
- 设备被其他程序占用

**解决方案**:
1. 检查硬件连接状态
2. 重启应用程序重新初始化
3. 检查是否有其他程序在使用IO板

#### 3. 权限问题
**错误现象**: 访问被拒绝或权限不足
**解决方案**:
- 以管理员权限运行应用程序
- 检查Windows防火墙设置
- 确认用户组权限配置

## 部署要求

### 硬件要求
- SMTGPIO兼容的IO板硬件
- 正确的硬件连接和配置

### 软件要求
- Windows操作系统
- .NET Framework 4.7.2或更高版本
- SMTGPIO.dll驱动文件

### 文件部署
1. 将`SMTGPIO.dll`复制到应用程序根目录
2. 确保所有SMTGPIO相关的C#文件已正确编译到项目中
3. 验证文件权限设置

## 使用流程

### 正常使用流程
1. **启动软件** → 自动初始化IO板
2. **执行检测** → VM检测完成后自动设置IO输出
3. **查看状态** → 在Page1日志中查看IO操作记录
4. **手动复位** → 必要时点击"IO复位"按钮
5. **退出软件** → 自动释放IO资源

### 故障排除流程
1. **检查日志** → 查看Page1界面的日志信息
2. **验证硬件** → 确认IO板连接状态
3. **重启软件** → 重新初始化IO系统
4. **联系支持** → 如问题持续存在

## 配置参数

### 默认配置
- **设备类型**: SCI_EVC3_5
- **端口配置**: 端口1, 引脚1和引脚2
- **输出规则**: OK时IO1=1/IO2=1, NG时IO1=1/IO2=0

### 自定义配置
如需修改配置，请编辑以下文件中的相关参数：
- `SMTGPIOController.cs`: 设备类型和基础配置
- `IOManager.cs`: 输出逻辑和错误处理
- `TemplateConfigPage.xaml.cs`: 检测结果映射规则

## 技术支持

### 联系信息
- 开发团队: 博信科技
- 技术支持: support@posen.com
- 更新日期: 2024年

### 调试建议
1. 启用详细日志记录
2. 使用Windows设备管理器检查硬件状态
3. 运行IO板厂商提供的测试工具验证硬件功能
4. 检查Windows事件日志中的相关错误信息

---

**注意**: 请确保在修改IO相关代码时充分测试，避免影响生产环境的正常运行。 