{
  "project": "Platform",
  "branchName": "ralph/tray-matrix-detection-component",
  "description": "Tray Matrix Detection Component - standardize tray-based matrix inspection with unified APIs, visualization, history, and help docs.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add SQLite schema for tray history and material results",
      "description": "As a developer, I want a SQLite schema for trays and tray items so that tray history can be persisted and queried.",
      "acceptanceCriteria": [
        "Create tables for tray header (tray_id, rows, cols, batch_name, created_at, completed_at) and tray items (tray_id, row, col, result, image_path, detection_time)",
        "Add indexes for tray_id and detection_time",
        "Provide a migration or initialization routine that creates the tables if missing",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Implement tray coordinate mapping utilities",
      "description": "As a developer, I want reusable mapping functions so that index-based results map to tray row/col consistently.",
      "acceptanceCriteria": [
        "Provide functions for Index -> (Row, Col) and (Row, Col) -> Index",
        "Support snake (S) and sequential row-wise mapping, with default snake mapping matching legacy behavior",
        "Unit tests cover odd/even rows, boundaries, and both mapping modes",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Create tray data model and in-memory manager",
      "description": "As a developer, I want a tray data model and manager so that current tray state and statistics can be managed in memory.",
      "acceptanceCriteria": [
        "Define TrayData, MaterialData, and TrayStatistics models",
        "Implement TrayDataManager with create, update, complete, reset, and history list",
        "Expose OK/NG counts, yield rate, and defect distribution",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Add SQLite persistence adapter for tray data",
      "description": "As a developer, I want a persistence layer so that tray data is stored and loaded from SQLite.",
      "acceptanceCriteria": [
        "Persist tray header on creation and update completed_time when tray completes",
        "Persist each material result with position, result, image_path, detection_time",
        "Provide methods to load recent N trays and their items",
        "Typecheck passes",
        "Tests pass"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Expose standardized Tray Component API and events",
      "description": "As a platform developer, I want a unified API so that algorithm results can update the tray component consistently.",
      "acceptanceCriteria": [
        "Implement StartTray(rows, cols, batchName), UpdateResult(position, result, imagePath, time), CompleteTray(), ResetCurrentTray(), GetStatistics(), GetHistory(limit)",
        "Expose events OnResultProcessed, OnTrayCompleted, OnError with position/result/time/imagePath",
        "API uses TrayDataManager and persistence adapter",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Render tray grid UI with row/col labels",
      "description": "As an operator, I want to see a tray grid with coordinates so that I can locate positions quickly.",
      "acceptanceCriteria": [
        "Render a grid with row/column labels, origin at bottom-left (1,1)",
        "Grid updates when layout rows/cols change",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": true,
      "notes": "dev-browser skill unavailable; UI verification not run in browser."
    },
    {
      "id": "US-007",
      "title": "Add defect status rendering with icon folder config",
      "description": "As an operator, I want defect states shown with icons and colors so that status is obvious at a glance.",
      "acceptanceCriteria": [
        "Define defect state mapping to icon filenames and fallback colors",
        "Load icons from a configurable folder path and scale to fit cells",
        "When icon missing, fall back to color-only display",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 7,
      "passes": true,
      "notes": "dev-browser skill unavailable; UI verification not run in browser."
    },
    {
      "id": "US-008",
      "title": "Add good-item visibility toggle",
      "description": "As an operator, I want to hide/show good items so that NG positions are easier to review.",
      "acceptanceCriteria": [
        "Provide a toggle to hide/show OK states",
        "Hidden OK cells become disabled and visually subdued",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Support 90-degree rotation display",
      "description": "As an operator, I want to rotate the tray view so that it matches physical orientation without changing logical coordinates.",
      "acceptanceCriteria": [
        "Provide a 90-degree rotation toggle for the tray view",
        "Rotation does not change logical position mapping or labels",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Add single-cell image viewer",
      "description": "As an engineer, I want to click a tray cell to view its image and result details.",
      "acceptanceCriteria": [
        "Clicking a cell opens an image viewer showing position, result, and image",
        "Image auto-scales to fit without distortion",
        "If the current cell is updated, the viewer refreshes automatically",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Add NG browser for current and history trays",
      "description": "As an engineer, I want to browse NG images from current or history trays so that defects can be reviewed efficiently.",
      "acceptanceCriteria": [
        "Provide NG browsing modes: current tray, selected history tray, and all history",
        "Support pagination and display image path tooltip",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Add manual retest event hook",
      "description": "As an operator, I want to request a manual retest for a position so that the system can recheck specific cells.",
      "acceptanceCriteria": [
        "Expose an event or callback for manual retest requests with row/col",
        "Upstream integration can trigger PLC/camera and then call UpdateResult",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Document Tray component in Help menu",
      "description": "As a user, I want a Help menu entry for the Tray component so that I can see interfaces, mapping rules, and examples.",
      "acceptanceCriteria": [
        "Help menu includes a Tray component entry",
        "Documentation covers API, data structures, mapping rules, defect states, and example integration",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    }
  ]
}
