# PRD — 设备管理模块

## 1. 背景与目标

当前平台对设备连接与参数配置缺乏统一入口，配置分散且复用性弱。需要建立设备管理模块，用于统一配置、管理与调用远端设备（PLC 等），并提供清晰的可视化设备列表与连接状态。

目标：
- 支持设备的创建、查看、修改、删除与持久化。
- 在设备列表中实时展示连接状态。
- 其他模块可快速调用设备，实现读写与命令下发。
- 将“帮助”中的 PLC 串口设置迁移到设备管理模块中。
- MVP 阶段仅实现“基恩士 PLC 串口连接”，但预留扩展能力。

非目标：
- 不实现多厂商 PLC 的完整协议适配（仅基恩士串口）。
- 不实现现场布线、硬件诊断等运维功能。
- 不新增新的权限系统或多租户管理逻辑。

---

## 2. 用户角色

- 操作员：查看设备状态，必要时修改参数。
- 工程师：配置新设备，调试读写。
- 系统集成方：通过标准接口调用设备进行读写。

---

## 3. 需求概述（来自原始 PRD）

1) 允许设置协议类型、设备名称、目标 IP 及端口等参数，完成配置后可创建设备。
2) 软件打开时自动加载已创建的设备。
3) 允许删除已创建的设备。
4) 允许查看设备列表。
5) 设备列表中可直接看到设备是否连接。
6) 点击设备可查看和修改设备参数。
7) 其他模块允许快速调用设备，实现对远端设备的读取与写入。
8) 当前只实现基恩士 PLC 的串口连接。
9) 将“帮助”中的 PLC 串口设置迁移到设备管理模块中。

---

## 4. 用户故事与验收标准

### US-001 创建设备
**描述：** 作为工程师，我希望配置设备参数后创建设备，以便平台可管理该设备。  
**验收标准：**
- [ ] 支持选择协议类型（至少包含：串口、TCP/IP；MVP 实现串口）。
- [ ] 允许填写设备名称、目标地址（IP/端口）或串口参数（端口号/波特率/数据位/停止位/校验）。
- [ ] 保存后设备出现在设备列表中，且参数持久化。
- [ ] 参数校验通过后才允许保存（必填/格式/范围）。

### US-002 设备自动加载
**描述：** 作为操作员，我希望软件启动后自动加载已创建设备，以便无须重复配置。  
**验收标准：**
- [ ] 启动时自动加载本地已保存的设备清单。
- [ ] 设备列表在 3 秒内可见（不含连接成功判定时间）。

### US-003 删除设备
**描述：** 作为工程师，我需要删除不再使用的设备，避免误用。  
**验收标准：**
- [ ] 设备支持删除，且有确认弹窗。
- [ ] 删除后不再出现在列表中，持久化记录同步移除。

### US-004 查看设备列表与状态
**描述：** 作为操作员，我希望看到设备列表和连接状态。  
**验收标准：**
- [ ] 设备列表展示：名称、协议类型、地址、连接状态、最近连接时间（如有）。
- [ ] 连接状态至少包含：未连接/连接中/已连接/失败。

### US-005 编辑设备参数
**描述：** 作为工程师，我希望点击设备后修改参数并保存。  
**验收标准：**
- [ ] 点击设备进入详情页或编辑弹窗。
- [ ] 保存后立即生效（需要重连时提示并执行）。

### US-006 设备读写接口
**描述：** 作为系统集成方，我希望调用标准接口快速读写设备。  
**验收标准：**
- [ ] 提供标准接口（如 `IDeviceManager`/`IDeviceClient`）进行连接、读、写。
- [ ] 接口可按设备 ID/名称定位设备。
- [ ] 读写异常有统一错误返回与日志记录。

### US-007 帮助迁移
**描述：** 作为用户，我希望在设备管理模块中查看 PLC 串口设置说明。  
**验收标准：**
- [ ] “帮助”中原有 PLC 串口设置文档迁移至设备管理模块。
- [ ] 设备管理模块内可直接访问该说明（内嵌说明或跳转）。

---

## 5. 功能需求

- FR-1 设备管理 CRUD：创建、查看、编辑、删除。
- FR-2 设备参数校验：协议必填、名称必填、IP/端口格式校验、串口参数范围校验。
- FR-3 启动自动加载设备配置。
- FR-4 设备连接状态可视化（列表直接显示）。
- FR-5 设备详情查看与编辑。
- FR-6 设备读写与连接管理接口（对外提供统一调用）。
- FR-7 基恩士 PLC 串口连接实现。
- FR-8 “帮助”中的 PLC 串口设置迁移到设备管理模块。

---

## 6. 数据模型（建议）

**Device**
- Id: string
- Name: string
- ProtocolType: enum (Serial, TcpIp, ...)
- Address: string (IP 或串口端口号)
- Port: int (TCP 端口; 串口可为空)
- SerialOptions: { BaudRate, DataBits, StopBits, Parity }
- Enabled: bool
- LastConnectedAt: datetime?
- Status: enum (Disconnected, Connecting, Connected, Error)
- CreatedAt / UpdatedAt

注：实际字段以现有配置/持久化方案为准（配置文件）。

---

## 7. 交互与界面（建议）

- 设备管理入口：主菜单或功能区新增“设备管理”。
- 列表页：展示设备列表与连接状态；提供“新增/编辑/删除”。
- 详情页或弹窗：展示设备参数，支持保存与测试连接。
- 串口设置说明：在设备管理页面内提供“串口设置说明/帮助”。

（原始 PRD 中的界面草图见 Obsidian 图片：`Pasted image 20260204135512.png`。）

---

## 8. 技术与集成考虑

- 设备读写接口需支持异步调用，避免阻塞 UI 线程。
- 连接状态需要可更新（定时探测或事件驱动）。
- 设备配置持久化位置与格式需与现有平台一致（配置文件）。
- 后续扩展协议类型时，保持与 `ProtocolType` 和 `IDeviceClient` 的兼容。

---

## 9. 里程碑（建议）

1) 设备模型与持久化方案确定
2) 设备管理 UI（列表 + 详情）
3) 设备连接状态与读写接口
4) 基恩士 PLC 串口接入
5) 帮助迁移与文档完善

---

## 10. 风险与开放问题

- 连接状态刷新策略是否影响性能或稳定性？
- 设备读写的并发与线程安全策略如何设计？
- 串口参数默认值是否统一（波特率/校验位）？

---

> 若 PRD 认可，可按以上里程碑进行开发与拆解任务。
